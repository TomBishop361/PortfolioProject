# PortfolioProject — Entity Component System (ECS) Overview

This repository includes a small, custom Entity Component System (ECS) built on top of Unreal Engine. The ECS was created to experiment with data-driven entity composition, decoupled systems, and lightweight game logic. This README explains the architecture, how the pieces fit together, and how to add components and systems.

Table of contents
- Overview
- High-level architecture
- Key classes & files
- How it works (entity creation, component authoring, ticking)
- How to add a component
- How to add a system
- Notes, limitations, and future improvements

---

Overview
--------
The ECS used in this project separates data (components) from behavior (systems). Entities are simply IDs (EntityID = uint32). Components are plain data structs stored in typed component containers. Systems implement a simple `ISystemInterface` and operate over component data each tick. The ECSManager coordinates entity lifecycle, component storage, and system execution.

High-level architecture
-----------------------
- Entities: lightweight IDs generated by the ECS (EntityID).
- Components: data-only types (e.g. `FPositionComponent`, `FHealthComponent`) stored in component-specific storage inside the ECS.
- Component Authors: UObject-derived helpers (Blueprintable) used by actors to compose entities at runtime (e.g. `UPositionComponentAuthor`, `UhealthComponentAuthor`).
- Systems: logic units implementing `ISystemInterface` (e.g. `FMovementSystem`, `FHealthSystem`) that operate on components each tick.
- Manager  `UECSManager` hold storage, entity lists, and dispatch systems. An actor `AECSTickObject` calls `ECS->Tick()` each frame.

Key classes & files
-------------------
- ECS manager
  - Source/PortfolioProject/ECSManager.h / ECSManager.cpp — main UE subsystem that exposes the ECS to the game (create/destroy entities, add/remove components, tick logic).  
- Component authors (Blueprint-friendly)
  - Source/PortfolioProject/componentAuthorBase.h — base class `UcomponentAuthorBase` (abstract). Authors are instanced on actors in editor and add components in code during BeginPlay.
  - Source/PortfolioProject/positionComponentAuthor.h / .cpp — example position author that calls `ecs->AddComponent<FPositionComponent>(...)`.
  - Source/PortfolioProject/healthComponentAuthor.h / .cpp — example health author that adds `FHealthComponent`.
- Components & related
  - `PositionComponent`, `HealthComponent`, `DamageRequestComponent`, `TransformLinkComponent` — these are the data types used by systems (see component files in the repo).
- Systems
  - Source/PortfolioProject/SystemInterface.h — declares `ISystemInterface` with `virtual void Perform(UECSManager* ECS) = 0;`
  - Source/PortfolioProject/MovementSystem.h / .cpp — movement logic operating on position/transform components.
  - Source/PortfolioProject/HealthSystem.h / .cpp — health management and damage handling.
- Actors & helpers
  - Source/PortfolioProject/EntityBase.h / .cpp — an actor that owns an entity ID and an array of `UcomponentAuthorBase*` instances (`ecsComponents`). At BeginPlay it creates an entity and uses each author to add components.
  - Source/PortfolioProject/EntitySpawnManager.h / .cpp — a spawner that creates actors/entities to populate the world.
  - Source/PortfolioProject/ECSTickObject.h / .cpp — an actor that calls `ECS->Tick()` every frame so systems run.

How it works (flow)
-------------------
1. Initialization
   - `UECSManager` is a UE subsystem (accessible from `UGameInstance`) and maintains component storage, active entities, and systems.
2. Creating an entity
   - `AEntityBase::BeginPlay()` gets the `UECSManager` and calls `ECS->CreateEntity()` to obtain an `EntityID`.
   - For each `UcomponentAuthorBase` in the actor's `ecsComponents` array, the actor calls `author->AddToEntity(entity, ECS)` to add component instances/data to the ECS for that entity.
   - `UcomponentAuthorBase` implementations call a template `AddComponent<T>` on the ECS manager (see `positionComponentAuthor.cpp` and `healthComponentAuthor.cpp`).
3. Per-frame processing
   - `AECSTickObject::Tick()` calls `ECS->Tick()`.
   - `UECSManager::Tick()` (implementation in `ECSManager.cpp`) dispatches each registered system’s `Perform(UECSManager*)` which reads/writes component data and schedules entity/component destruction or modification.
4. Destruction & cleanup
   - `UECSManager` supports removing components for an entity and processing queued destruction requests (see `removeAllComponentsFromEntity()` and `processDestructionRequests()` in `ECSManager.cpp`).

Examples from code
------------------
- Entity creation and adding components:
  - `AEntityBase::BeginPlay()` — creates entity and iterates `ecsComponents`, calling `author->AddToEntity(e, ECS)` (see Source/PortfolioProject/EntityBase.cpp).
- Component author example:
  - `UPositionComponentAuthor::AddToEntity` calls `ecs->AddComponent<FPositionComponent>(entity, positionData)` (see Source/PortfolioProject/positionComponentAuthor.cpp).
  - `UhealthComponentAuthor::AddToEntity` calls `ecs->AddComponent<FHealthComponent>(entity, HealthData)` (see Source/PortfolioProject/healthComponentAuthor.cpp).
- Systems:
  - `FMovementSystem` and `FHealthSystem` both implement `ISystemInterface` and are invoked by the manager during Tick (see Source/PortfolioProject/MovementSystem.h and HealthSystem.h/.cpp).

How to add a new component
--------------------------
1. Define a data struct (e.g. `FMyComponent`) in an appropriate header (replicate style of `PositionComponent` or `HealthComponent`).
2. Create a Blueprintable component author:
   - Derive a UObject from `UcomponentAuthorBase` (like `UPositionComponentAuthor`).
   - Add property fields (UPROPERTY EditAnywhere) to expose data to designer/blueprints.
   - Override `AddToEntity(EntityID entity, UECSManager* ecs)` and call `ecs->AddComponent<FMyComponent>(entity, MyData)`.
3. In editor, add an instance of your new ComponentAuthor to an `AEntityBase` actor's `ecsComponents` array.
4. Run — on BeginPlay the Actor will create an entity and add the component data to the ECS.

How to add a new system
-----------------------
1. Create a struct that implements `ISystemInterface`:
   - Provide `void Perform(UECSManager* ECS) override;`
   - Query component storage from the ECS and implement behavior (examples: `MovementSystem`, `HealthSystem`).
2. Register the system with the ECSManager (see ECSManager initialization code). Systems already present (Movement & Health) show the registration/use pattern.
3. Implement `Perform` to operate on the components and schedule removals/destroys via the ECSManager API if needed.

Notes, limitations & future improvements
---------------------------------------
- Blueprint-friendly component authors make data authoring easy, but the current implementation is not optimized for maximum data locality or cache friendliness — it's a practical, learning-oriented design.
- Systems are run each tick synchronously. Consider jobifying or parallelizing systems for CPU-bound scenarios.
- There isn’t currently a robust query API for systems (e.g., fast archetype-based iteration). Adding an archetype or sparse-set storage model would improve performance.
- Consider improving lifetime management and adding defensive checks / logging around component access to avoid use-after-free issues.

Files of immediate interest
- [Source/PortfolioProject/ECSManager.h](https://github.com/TomBishop361/PortfolioProject/blob/main/Source/PortfolioProject/ECSManager.h)
- [Source/PortfolioProject/ECSManager.cpp](https://github.com/TomBishop361/PortfolioProject/blob/main/Source/PortfolioProject/ECSManager.cpp)
- [Source/PortfolioProject/EntityBase.cpp](https://github.com/TomBishop361/PortfolioProject/blob/main/Source/PortfolioProject/EntityBase.cpp)
- [Source/PortfolioProject/componentAuthorBase.h](https://github.com/TomBishop361/PortfolioProject/blob/main/Source/PortfolioProject/componentAuthorBase.h)
- [Source/PortfolioProject/positionComponentAuthor.cpp](https://github.com/TomBishop361/PortfolioProject/blob/main/Source/PortfolioProject/positionComponentAuthor.cpp)
- [Source/PortfolioProject/healthComponentAuthor.cpp](https://github.com/TomBishop361/PortfolioProject/blob/main/Source/PortfolioProject/healthComponentAuthor.cpp)
- [Source/PortfolioProject/MovementSystem.h](https://github.com/TomBishop361/PortfolioProject/blob/main/Source/PortfolioProject/MovementSystem.h)
- [Source/PortfolioProject/HealthSystem.h](https://github.com/TomBishop361/PortfolioProject/blob/main/Source/PortfolioProject/HealthSystem.h)
- [Source/PortfolioProject/ECSTickObject.cpp](https://github.com/TomBishop361/PortfolioProject/blob/main/Source/PortfolioProject/ECSTickObject.cpp)

